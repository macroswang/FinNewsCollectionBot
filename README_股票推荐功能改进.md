# 股票推荐功能改进说明

## 🎯 改进目标

根据用户需求，对股票推荐功能进行了以下改进：

1. **具体股票推荐从热点板块和轮动机会中通过AI总结后产生**
2. **显示推荐股票的最新价格数据**

## ✨ 主要改进内容

### 1. AI摘要生成优化

- 修改了 `summarize()` 函数的提示词
- 强调具体股票推荐必须从热点板块和轮动机会中通过AI分析总结后产生
- 确保推荐的股票与新闻热点和板块轮动逻辑直接相关

### 2. 股票推荐格式改进

**原格式：**
```
- **600276 恒瑞医药** 🟡 ⚡ 📈
  - 推荐理由: 创新药龙头，国际化管线潜力大，估值偏低
  - 风险等级: 中
  - 短线潜力: 8%-12%
  - 建议持仓: 3-5天
  - 买入策略: 回调至42元附近
  - 卖出策略: 47元上方分批止盈
```

**新格式：**
```
**600276 恒瑞医药**
推荐理由：创新药龙头，国际化管线潜力大，估值偏低。
风险等级：中。
短线潜力：8%-12%。
建议持仓时间：3-5天。
买入策略：回调至42元附近。
卖出策略：47元上方分批止盈
**最新价格：¥42.50 📈 1.25% ⚡ 东方财富**
技术面：上涨 | MA20:¥41.80 | MA50:¥40.20
支撑/阻力：¥40.50 / ¥44.30
成交量：🔥 1.6倍
估值：PE25.3 | PB3.8
更新时间：14:30:25
```

### 3. 实时数据集成

- 集成了多数据源实时价格获取（东方财富、新浪财经、腾讯财经）
- 显示当前价格、涨跌幅、数据源、更新时间
- 包含技术面分析（MA20、MA50、趋势判断）
- 显示支撑阻力位、成交量分析、估值数据

### 4. 数据源优先级

1. **实时数据模块** (`real_time_stock_data.py`)
   - 东方财富API
   - 新浪财经API
   - 腾讯财经API

2. **备用数据源** (`yfinance`)
   - 技术指标计算
   - 基本面数据
   - 历史数据分析

## 📊 功能特点

### 短线交易导向
- 持仓时间：1-5个交易日
- 止盈目标：≤10%
- 止损设置：≤-3%
- 快进快出策略

### 数据完整性
- 实时价格和涨跌幅
- 技术面分析（MA20、MA50、趋势）
- 支撑阻力位
- 成交量分析
- 估值数据（PE、PB）
- 数据源标识
- 更新时间

### 风险控制
- 风险等级标识（低/中/高）
- 短线潜力评估
- 具体买入卖出策略
- 止损止盈建议

## 🔧 技术实现

### 核心函数

1. **`summarize()`** - AI摘要生成
   - 优化提示词，确保股票推荐从热点板块和轮动机会中产生
   - 包含全球联动分析

2. **`extract_stock_recommendations_from_summary()`** - 股票推荐提取
   - 从AI摘要中解析股票推荐信息
   - 支持热点板块和轮动机会分类

3. **`get_real_time_stock_data()`** - 实时数据获取
   - 多数据源获取实时价格
   - 技术指标计算
   - 基本面数据获取

4. **`get_stock_industry()`** - 行业分类
   - 动态获取股票行业分类
   - 备用分类机制

### 数据流程

```
新闻内容 → AI分析 → 热点板块识别 → 股票推荐生成 → 实时数据获取 → 格式化显示
                ↓
            轮动机会识别 → 股票推荐生成 → 实时数据获取 → 格式化显示
```

## 📈 使用示例

### 热点板块股票推荐
```
**300750 宁德时代**
推荐理由：动力电池龙头，技术领先，短线关注业绩预期。
风险等级：中。
短线潜力：高。
建议持仓时间：3-5天。
买入策略：回调买入，关注量能。
卖出策略：分批止盈，设置止损
**最新价格：¥180.50 📈 2.35% ⚡ 东方财富**
技术面：上涨 | MA20:¥175.20 | MA50:¥168.80
支撑/阻力：¥165.30 / ¥185.60
成交量：🔥 1.8倍
估值：PE45.2 | PB8.5
更新时间：14:30:25
```

### 轮动机会股票推荐
```
**000858 五粮液**
推荐理由：白酒龙头，品牌价值高，消费复苏。
风险等级：低。
短线潜力：中。
建议持仓时间：2-4天。
买入策略：回调买入，关注销量。
卖出策略：分批止盈，长期持有
**最新价格：¥165.80 📉 -0.85% ⚡ 新浪财经**
技术面：震荡 | MA20:¥168.40 | MA50:¥172.10
支撑/阻力：¥160.20 / ¥175.30
成交量：📊 0.9倍
估值：PE25.6 | PB4.2
更新时间：14:30:15
```

## 🚀 部署说明

1. 确保环境变量设置正确：
   - `OPENAI_API_KEY`
   - `SERVER_CHAN_KEYS`

2. 安装依赖包：
   ```bash
   pip install -r requirements.txt
   ```

3. 运行主程序：
   ```bash
   python financebot.py
   ```

## 📝 注意事项

1. **数据源稳定性**：实时数据获取可能受网络和API限制影响
2. **AI分析准确性**：股票推荐基于AI分析，仅供参考
3. **风险提示**：投资有风险，入市需谨慎
4. **数据延迟**：实时数据可能存在延迟，建议结合其他数据源验证

## 🔄 后续优化方向

1. 增加更多数据源以提高数据获取成功率
2. 优化AI提示词以提高股票推荐准确性
3. 增加更多技术指标和分析工具
4. 实现历史推荐效果追踪
5. 增加个性化推荐功能 